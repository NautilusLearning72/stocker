<div class="grid">
  <mat-card class="card">
    <mat-card-title>Universes</mat-card-title>
    <mat-card-content>
      <mat-form-field appearance="outline" class="full">
        <mat-label>Select universe</mat-label>
        <mat-select [(ngModel)]="selectedUniverseId" (selectionChange)="loadUniverseDetail()">
          <mat-option *ngFor="let u of universes" [value]="u.id">
            {{ u.name }} <span *ngIf="u.is_global">(global)</span>
          </mat-option>
        </mat-select>
      </mat-form-field>

      <div class="members-header">
        <h4>Members ({{ members.length }})</h4>
        <span class="status" *ngIf="members.length === 0">No symbols yet</span>
      </div>

      <div class="member-actions">
        <mat-form-field appearance="outline" class="full">
          <mat-label>Add symbols (comma/space separated)</mat-label>
          <textarea matInput rows="3" [(ngModel)]="addSymbolsInput"></textarea>
        </mat-form-field>
        <button mat-raised-button color="primary" (click)="addMembers()">Add</button>
      </div>

      <div class="chips">
        <mat-chip *ngFor="let sym of members" (removed)="removeMember(sym)">
          <div class="chip-content">
            <div class="chip-symbol">{{ sym }}</div>
            <div class="chip-name">{{ instrumentNames[sym] || '—' }}</div>
          </div>
          <button matChipRemove><mat-icon>close</mat-icon></button>
        </mat-chip>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="card">
    <mat-card-title>Create a universe</mat-card-title>
    <mat-card-content class="create-form">
      <mat-form-field appearance="outline" class="full">
        <mat-label>Name</mat-label>
        <input matInput [(ngModel)]="newUniverseName" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="full">
        <mat-label>Description</mat-label>
        <textarea matInput rows="2" [(ngModel)]="newUniverseDescription"></textarea>
      </mat-form-field>
      <mat-form-field appearance="outline" class="full">
        <mat-label>Initial symbols (optional)</mat-label>
        <textarea matInput rows="3" [(ngModel)]="newUniverseSymbolsInput"></textarea>
      </mat-form-field>
      <button mat-raised-button color="accent" (click)="createUniverse()">Create</button>
    </mat-card-content>
  </mat-card>

  <mat-card class="card">
    <mat-card-title>Strategy mapping</mat-card-title>
    <mat-card-content class="strategy">
      <mat-form-field appearance="outline" class="full">
        <mat-label>Strategy ID</mat-label>
        <input matInput [(ngModel)]="strategyId" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="full">
        <mat-label>Universe</mat-label>
        <mat-select [(ngModel)]="selectedStrategyUniverseId">
          <mat-option *ngFor="let u of universes" [value]="u.id">{{ u.name }}</mat-option>
        </mat-select>
      </mat-form-field>
      <button mat-raised-button color="primary" (click)="assignStrategy()">Assign</button>
    </mat-card-content>
  </mat-card>

  <mat-card class="card">
    <mat-card-title>Metrics status</mat-card-title>
    <mat-card-content>
      <table mat-table [dataSource]="members" class="metrics-table" *ngIf="members.length">
        <ng-container matColumnDef="symbol">
          <th mat-header-cell *matHeaderCellDef>Symbol</th>
          <td mat-cell *matCellDef="let sym">{{ sym }}</td>
        </ng-container>
        <ng-container matColumnDef="as_of_date">
          <th mat-header-cell *matHeaderCellDef>Metrics As Of</th>
          <td mat-cell *matCellDef="let sym">
            {{ metrics[sym]?.as_of_date || '—' }}
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="['symbol', 'as_of_date']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['symbol', 'as_of_date'];"></tr>
      </table>
      <div *ngIf="!members.length" class="status">No symbols to show.</div>
    </mat-card-content>
  </mat-card>
</div>

<div class="error" *ngIf="errorMsg">{{ errorMsg }}</div>
