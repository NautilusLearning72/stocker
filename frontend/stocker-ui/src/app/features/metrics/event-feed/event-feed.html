<div class="Box-header">
  <div class="d-flex flex-items-center flex-justify-between flex-wrap gap-3">
    <div class="d-flex flex-items-center gap-3 flex-wrap">
      <!-- Category filter -->
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Category</mat-label>
        <mat-select [(ngModel)]="selectedCategory" (selectionChange)="onCategoryChange()">
          <mat-option value="">All Categories</mat-option>
          <mat-option *ngFor="let cat of getCategoryKeys()" [value]="cat">
            {{ cat }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Event type filter -->
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Event Type</mat-label>
        <mat-select
          [(ngModel)]="selectedEventType"
          (selectionChange)="onEventTypeChange()"
          [disabled]="!selectedCategory">
          <mat-option value="">All Types</mat-option>
          <mat-option *ngFor="let type of eventTypeOptions" [value]="type">
            {{ type }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Symbol filter -->
      <mat-form-field appearance="outline" class="filter-field symbol-field">
        <mat-label>Symbol</mat-label>
        <input
          matInput
          [(ngModel)]="symbolFilter"
          (change)="onSymbolFilterChange()"
          placeholder="e.g., AAPL">
      </mat-form-field>

      <!-- Clear button -->
      <button
        mat-stroked-button
        (click)="clearFilters()"
        [disabled]="!selectedCategory && !selectedEventType && !symbolFilter"
        class="btn-sm">
        Clear
      </button>
    </div>

    <!-- Live indicator -->
    <div *ngIf="isLive" class="live-indicator">
      <span class="live-dot"></span>
      <span class="live-text">Live</span>
    </div>
  </div>
</div>

<div class="Box-body">
  <!-- Loading overlay -->
  <div *ngIf="loading" class="loading-overlay">
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <!-- Events table -->
  <div class="table-container" *ngIf="!loading && events.length > 0">
    <table class="github-table">
      <thead>
        <tr>
          <th>Time</th>
          <th>Category</th>
          <th>Event Type</th>
          <th>Symbol</th>
          <th>Value</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let event of events; let i = index" [class.new-event]="isLive && i === 0">
          <td class="timestamp-cell">
            <span class="time">{{ formatTimestamp(event.timestamp) }}</span>
            <span class="date">{{ formatDate(event.timestamp) }}</span>
          </td>
          <td>
            <span class="badge" [class]="'badge-' + getCategoryColor(event.category)">
              {{ event.category }}
            </span>
          </td>
          <td>
            <span
              class="event-type"
              [matTooltip]="getEventDescription(event.event_type)"
              matTooltipPosition="above">
              {{ event.event_type }}
            </span>
          </td>
          <td>
            <app-symbol-link *ngIf="event.symbol" [symbol]="event.symbol"></app-symbol-link>
            <span *ngIf="!event.symbol" class="text-muted">â€”</span>
          </td>
          <td class="value-cell">
            {{ formatValue(event.value) }}
          </td>
          <td class="metadata-cell">
            <span
              [matTooltip]="getFullMetadata(event.metadata)"
              matTooltipClass="metadata-tooltip"
              class="metadata-preview">
              {{ formatMetadata(event.metadata) }}
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Empty state -->
  <div *ngIf="!loading && events.length === 0" class="empty-state">
    <mat-icon class="empty-icon">inbox</mat-icon>
    <p class="empty-text">No events found</p>
    <p class="empty-subtext">Try adjusting your filters or time range</p>
  </div>
</div>
