<div class="activity-tab">
  <!-- Loading -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="32"></mat-spinner>
    <p>Loading activity data...</p>
  </div>

  <ng-container *ngIf="!loading">
    <!-- Current Holding -->
    <mat-card class="holding-card">
      <mat-card-content>
        <h3>
          <mat-icon>account_balance_wallet</mat-icon>
          Current Position
        </h3>
        <div class="no-holding" *ngIf="!holding">
          <p>You don't currently hold any shares of {{ symbol }}.</p>
        </div>
        <div class="holding-details" *ngIf="holding">
          <div class="detail-item">
            <span class="label">Quantity</span>
            <span class="value">{{ holding.qty | number:'1.0-4' }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Cost Basis</span>
            <span class="value">${{ holding.cost_basis | number:'1.2-2' }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Market Value</span>
            <span class="value">${{ holding.market_value | number:'1.2-2' }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Unrealized P&L</span>
            <span
              class="value pnl"
              [class.positive]="getPnL()! >= 0"
              [class.negative]="getPnL()! < 0"
            >
              {{ getPnL()! >= 0 ? '+' : '' }}${{ getPnL() | number:'1.2-2' }}
              ({{ getPnLPercent() | number:'1.2-2' }}%)
            </span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Order History -->
    <mat-card class="orders-card">
      <mat-card-content>
        <h3>
          <mat-icon>receipt_long</mat-icon>
          Order History
        </h3>
        <div class="no-data" *ngIf="orders.length === 0">
          <p>No orders found for {{ symbol }}.</p>
        </div>
        <div class="table-container" *ngIf="orders.length > 0">
          <table mat-table [dataSource]="orders" class="orders-table">
            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef>Date</th>
              <td mat-cell *matCellDef="let order">{{ order.date }}</td>
            </ng-container>

            <ng-container matColumnDef="side">
              <th mat-header-cell *matHeaderCellDef>Side</th>
              <td mat-cell *matCellDef="let order">
                <span class="side-badge" [ngClass]="getSideClass(order.side)">
                  {{ order.side }}
                </span>
              </td>
            </ng-container>

            <ng-container matColumnDef="qty">
              <th mat-header-cell *matHeaderCellDef>Quantity</th>
              <td mat-cell *matCellDef="let order">{{ order.qty | number:'1.0-4' }}</td>
            </ng-container>

            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let order">
                <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                  {{ order.status }}
                </span>
              </td>
            </ng-container>

            <ng-container matColumnDef="fill_price">
              <th mat-header-cell *matHeaderCellDef>Fill Price</th>
              <td mat-cell *matCellDef="let order">
                {{ getFillPrice(order) !== null ? '$' + (getFillPrice(order) | number:'1.2-2') : '-' }}
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="orderColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: orderColumns;"></tr>
          </table>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Recent Signals -->
    <mat-card class="signals-card">
      <mat-card-content>
        <h3>
          <mat-icon>show_chart</mat-icon>
          Recent Signals
        </h3>
        <div class="no-data" *ngIf="signals.length === 0">
          <p>No signals found for {{ symbol }}.</p>
        </div>
        <div class="table-container" *ngIf="signals.length > 0">
          <table mat-table [dataSource]="signals" class="signals-table">
            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef>Date</th>
              <td mat-cell *matCellDef="let signal">{{ signal.date }}</td>
            </ng-container>

            <ng-container matColumnDef="direction">
              <th mat-header-cell *matHeaderCellDef>Direction</th>
              <td mat-cell *matCellDef="let signal">
                <span class="direction-badge" [ngClass]="getDirectionClass(signal.direction)">
                  {{ getDirectionLabel(signal.direction) }}
                </span>
              </td>
            </ng-container>

            <ng-container matColumnDef="target_weight">
              <th mat-header-cell *matHeaderCellDef>Target Weight</th>
              <td mat-cell *matCellDef="let signal">
                {{ signal.target_weight !== null ? (signal.target_weight * 100 | number:'1.2-2') + '%' : '-' }}
              </td>
            </ng-container>

            <ng-container matColumnDef="momentum">
              <th mat-header-cell *matHeaderCellDef>Momentum</th>
              <td mat-cell *matCellDef="let signal">
                {{ signal.lookback_return !== null ? (signal.lookback_return * 100 | number:'1.2-2') + '%' : '-' }}
              </td>
            </ng-container>

            <ng-container matColumnDef="volatility">
              <th mat-header-cell *matHeaderCellDef>Volatility</th>
              <td mat-cell *matCellDef="let signal">
                {{ signal.ewma_vol !== null ? (signal.ewma_vol * 100 | number:'1.2-2') + '%' : '-' }}
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="signalColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: signalColumns;"></tr>
          </table>
        </div>
      </mat-card-content>
    </mat-card>
  </ng-container>
</div>
